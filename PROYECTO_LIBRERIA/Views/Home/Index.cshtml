@{
    Layout = "~/Views/Shared/_LayoutLogin.cshtml";
}

@section scripts
{
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        var Contador = 0
        var UsuarioGlobal
        
        $("#btnIniciarSesion").on("click", function () {
            //alert("prueba");
            var xUsuario = $("#txtUsuario").val();
            var xContrasenia = $("#txtContrasenia").val();
            if (xUsuario != "" && xContrasenia != "") {

                $.ajax({
                    url: "@Url.Action("IniciarSesion", "Home")",
                    type: "POST",
                    data: {
                        usuario: xUsuario,
                        contrasenia: xContrasenia
                    },
                    success: function (data) {
                        // alert(data.estadoEnvio);
                      //  localStorage.setItem("xUsuarioValor", data.usuario);
                      //  localStorage.setItem("xrolusuario", data.rolDescripcion);
                       // localStorage.setItem("xIdusuario", data.iDusuario);
                        //alert (UsuarioGlobal)
                        if (data.codMensaje == "1") {
                            Swal.fire({
                                title: 'Inicio de sesión',
                                text: data.mensaje,
                                icon: "success",
                                confirmButtonText: "Aceptar"
                            }).then((result) => {
                                window.location.href = '/Home/IndexInformativo'
                            });
                        } else if (data.codMensaje == "2") {

                            Swal.fire({
                                title: 'Error',
                                text: data.mensaje,
                                icon: "error",
                                confirmButtonText: "Aceptar"
                            }).then((result) => {
                                //window.location.href = '/Home/Index'
                                $("#txtContrasenia").val("");
                                Contador = Contador + 1;
                                if (Contador == 5) {
                                    $.ajax({
                                        url: "@Url.Action("UsuarioInactivar", "Home")",
                                        type: "POST",
                                        data: { xUsuario: localStorage.getItem("xUsuarioValor") },
                                        success: function (data) {
                                            Swal.fire({
                                                title: 'Error',
                                                text: data.mensaje,
                                                icon: "warning",
                                                confirmButtonText: "Aceptar"
                                            }).then((result) => {
                                                //window.location.href = '/Home/Index'
                                                $("#txtUsuario").val("");
                                                $("#txtContrasenia").val("");
                                                Contador = 0
                                            })
                                        }
                                    });
                                }
                            })
                        }
                        else if (data.codMensaje == "3") {

                            Swal.fire({
                                title: 'Contraseña caducada',
                                text: data.mensaje,
                                icon: "warning",
                                confirmButtonText: "Aceptar"
                            }).then((result) => {
                                //window.location.href = '/Home/UsuariosLista'
                                $("#frmActualizarContrasenia").modal("show");
                            });
                        } else {

                            Swal.fire({
                                title: 'Error',
                                text: data.mensaje,
                                icon: "error",
                                confirmButtonText: "Aceptar"
                            }).then((result) => {
                                //window.location.href = '/Home/Index'
                                $("#txtUsuario").val("");
                                $("#txtContrasenia").val("");
                            })

                        }

                    }
                });
            } else {
               // alert("mensaje");
                Swal.fire({
                    title: "Error",
                    text: "Ingrese la contraseña y usuario",
                    icon: "warning",
                    confirmButtonText: "Aceptar"
                }).then((result) => {
                    $("txtUsuario").val("");
                    $("txtContrasenia").val("");
                })

            }
        });

        function MostrarFrmActualizarContrasenia() {
            $("#frmActualizarContrasenia").modal("show");

        }

        function ValidarContraseña() {
            let pass1 = $("#txtContraseniaUp").val();
            let pass2 = $("#txtContraseniaUp_2").val();

            if (pass1 != "" && pass2 != "") {
                if (pass1.length >= 7 || pass2.length >= 7) {

                    if (pass1.length == pass2.length && pass1 == pass2) {
                        //alert("iguales");
                        if (!/[a-zA-Z]/.test(pass1) && !/[a-zA-Z]/.test(pass2)) {
                            return alert("La contraseña debe contener al menos una letra.");
                        }
                        if (!/[0-9]/.test(pass1) && !/[0-9]/.test(pass2)) {
                            return alert("La contraseña debe contener al menos un número.");
                        }
                        if (!/[^a-zA-Z0-9]/.test(pass1) && !/[^a-zA-Z0-9]/.test(pass2)) {
                            return alert("La contraseña debe contener al menos un símbolo.");
                        }
                      //  return alert("Contraseña válida.");
                        $.ajax({
                            url: "@Url.Action("ContraseniaActualizar", "Home")",
                            type: "POST",
                            data: {
                                id: localStorage.getItem("xIdusuario"),
                                contrasenia: pass1
                            },
                            success: function (data) {
                                if (data.estadoEnvio == 1) {
                                    Swal.fire({
                                        title: 'Confirmado',
                                        text: data.mensaje,
                                        icon: "success",
                                        confirmButtonText: "Aceptar"
                                    }).then((result) => {
                                        window.location.href = '/Home/Index'
                                        //$("#frmActualizarContrasenia").modal("show");
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Error',
                                        text: data.mensaje,
                                        icon: "error",
                                        confirmButtonText: "Aceptar"
                                    }).then((result) => {
                                        window.location.href = '/Home/Index'
                                        //$("#frmActualizarContrasenia").modal("show");
                                    });
                                }
                            }
                        });

                        //$("#frmActualizarContrasenia").modal("hide");

                    } else {
                        alert("no son iguales las credenciales");
                    }

                } else {
                    alert("caracteres minimos de ingreso son de 7 ");
                }

            }
            else {
                alert("ingrese credenciales");
            }

        }


        function CerrarModalContrasenia() {
            $("#txtContraseniaUp").val("");
            $("#txtContraseniaUp_2").val("");
        }


    </script>
}



<head>
    <link href="~/css/Sweet2.css" rel="stylesheet" />
    <link href="~/css/Login.css" rel="stylesheet" />
</head>
<section class="vh-100">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-xl-10">
                <div class="card bg-dark  text-white" style="border-radius: 1rem;">
                    <div class="row g-0">
                        <div class="col-md-6 col-lg-5 d-none d-md-block">
                            <img src="~/img/FondoLogin.jpg"
                                 alt="login form" class="img-fluid" style="border-radius: 1rem 0 0 1rem; height:100%;" />
                        </div>
                        <div class="col-md-6 col-lg-7 d-flex align-items-center">
                            <div class="card-body p-4 p-lg-5 text-black">

                                <form>

                                    <div class=" align-items-center mb-3 pb-1">
                                       @*  <i class="fas fa-cubes fa-2x me-3" style="color: #ff6219;"></i>
                                        <span class="h1 fw-bold mb-0">Logo</span> *@
                                        <img src="~/img/logo2.png" class="" alt="Alternate Text" /> 
                                    </div>

                                    <h5 class="text-white-50 mb-5" style="letter-spacing: 1px;">SISTEMA DE CONTROL DE VENTAS DE LIBRERIA</h5>

                                    <div data-mdb-input-init class="form-outline-light form-white  mb-4">
                                        <input type="email" id="txtUsuario" class="form-control form-control-lg" placeholder="USUARIO" />
                                    </div>
                                    <div data-mdb-input-init class="form-outline form-white mb-4">
                                        <input type="password" id="txtContrasenia" class="form-control form-control-lg" placeholder="*******" />
                                    </div>

                                    <div class="pt-1 mb-4">
                                        <button data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-light btn-lg px-5" id="btnIniciarSesion" type="button">INICIAR SESION</button>
                                    </div>
                                                                            
                                    </p>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>